#!/usr/bin/env bash




if ! [ -x "$(command -v vagrant)" ]; then
  echo 'Error: vagrant is not installed.' >&2
  exit 1
fi


mkdir andock-vagrant-test
cd andock-vagrant-test
# Download vagrant file.
wget -q https://raw.githubusercontent.com/andock/andock/master/tests/vagrant/Vagrantfile

read -e -p "Which SSH key should be used?: " -i "~/.ssh/id_rsa.pub" KEY
eval KEY=$KEY
sed -i -e "s,id_rsa.pub,$KEY,g" "Vagrantfile"
# Add entries to your host.
sudo sed -i '/dev.andock.local/d' /etc/hosts

    # Update local hosts file.
    echo "
192.168.33.10    dev.andock.local" | sudo tee --append /etc/hosts

    echo "
192.168.33.10   master.demo-project.dev.andock.local" | sudo tee --append /etc/hosts


vagrant up
echo ""
echo "##########################################################################"
echo "Vagrant is up"
echo "Use 'dev.andock.local' as connection domain and"
echo "'{{branch}}.demo-project.dev.andock.local' as virtual host name."
echo ""
echo "You should now connect to the vagrant box with root@dev.andock.local"
echo ""
echo "##########################################################################"
echo ""